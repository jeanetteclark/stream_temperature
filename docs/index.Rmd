---
title: "AKOATS and SASAP Stream Temperature"

output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

```{r}
library(leaflet)
library(sf)
library(tidyr)
library(dplyr)
```

# Temperature Data

```{r, message = FALSE, warning = FALSE}
temp <- tempfile()
download.file("https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn%3Auuid%3Af6ab206b-312c-4caf-89c8-89eb9d031aac",temp, quiet = T)
t <- unzip(temp, exdir = tempfile())
shapefile <- st_read(t[grep(".shp", t)], quiet = T)
unlink(temp)
```

```{r}
sites <- read.csv("../data_access/data_pids.csv") %>% 
  drop_na()

sites <- st_as_sf(sites, 
                  coords = c('Longitude', 'Latitude'),
                  crs = "+init=epsg:4326", remove = F)
sites <- st_transform(sites, crs = 3338) 
shapefile <- st_transform(shapefile, crs = 3338)
```

```{r}
shapefile <- shapefile %>% sf::st_transform(4326)


epsg3338 <- leaflet::leafletCRS(
  crsClass = "L.Proj.CRS",
  code = "EPSG:3338",
  proj4def =  "+proj=aea +lat_1=55 +lat_2=65 +lat_0=50 +lon_0=-154 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",
  resolutions = 2^(16:7))

```

```{r}
sites$link <- paste('<a href=', sites$URL, '>', paste("Download", sites$FileName), '</a>')

sites$popup <- paste(sep = "<br/>", sites$link, sites$Waterbody, 
                     #can't figure out why the year ranges aren't working here
                     paste(sites$Start_year, "-", sites$End_year), 
                     sites$Contact_person, sites$Contact_email)

```

```{r}


factpal <- colorFactor("Set1", sites$Contact_person)


m <- leaflet::leaflet(shapefile, options = leaflet::leafletOptions(crs = epsg3338), width = "100%") %>% 
  leaflet::addPolygons(fillColor = "gray",
                             weight = 1,
                             fillOpacity = 0.7,
                             color = "white") %>%
   addCircleMarkers(data = sites, lat = ~Latitude, lng = ~Longitude, 
                    fillColor = ~factpal(Contact_person),
                    stroke = F,
                    fillOpacity = 1,
                    radius = 3,
                    popup = ~popup)

  
m
```

# Data Packages

Metadata for the above data is available in the data packages published on the KNB:

* [Alaska Center for Conservation Science, University of Alaska Anchorage. 2018. In-situ stream temperature monitoring, Southwest Alaska, 2013-2017. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/doi:10.5063/F1028PR9)
    + Contact: Dan Bogan, Alaska Center for Conservation Science

* [Christopher Sergeant. 2018. National Park Service, Southeast Alaska Network, In-situ stream temperature monitoring of the Indian River, Salmon River, and Taiya River, 2010-2016. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/doi:10.5063/F10P0X83)
    + Contact: Christopher Sergeant, National Park Service

* [US Fish and Wildlife Service Office of Subsistence Management. 2018. In-situ stream temperature monitoring at fish weirs, Alaska, 2008-2015. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/doi:10.5063/F1W0944C)
    + Contact: Margaret Perdue, United States Fish and Wildlife Service

* [Alaska Department of Fish and Game. 2018. In-situ stream temperature monitoring, Kodiak Island, Alaska. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/urn:uuid:6a67fcbc-6a2e-4282-b739-486ec9bb02d0)
    + Contact: Heather Finkle, Alaska Department of Fish and Game
    + Contact: Trenten Dodson, Kodiak Regional Aquaculture Association

* [Christopher Arp. 2018. In-situ stream temperature monitoring, North Slope, Alaska, 2011-2017. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/urn:uuid:e8e9f3f5-9b97-4359-be8f-d712d8c4f6fd)
    + Contact: Christopher Arp, University of Alaska Fairbanks

* [National Park Service (NPS), Southwest Alaska Network (SWAN). 2018. In-situ stream temperature monitoring, southwest Alaska. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/urn:uuid:f69e1996-e46f-4c67-9963-5c0c3bc8671a)
    + Contact: Paul Gabriel, National Park Service

* [Cook Inlet Keeper. 2018. In-situ stream temperature monitoring, Cook Inlet, Alaska, 2002-2017. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/urn:uuid:a98c0f5d-a5e6-49ae-8aa2-132875d35476)
    + Contact: Sue Mauger, Cook Inlet Keeper

* [United States Fish and Wildlife Service. 2017. In-situ stream temperature monitoring, Alaska. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/urn:uuid:cb0d6944-db7f-438e-8a82-ec4c39972c1b)
    + Contact: Margaret Perdue, United States Fish and Wildlife Service

* [National Park Service, Central Alaska Network. 2017. In-situ stream temperature monitoring, central Alaska, 2008-2017. Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/urn:uuid:b63d3d3f-f745-425f-a69f-998154895f40)
    + Contact: Trey Simmons, National Park Service

* [U.S. Geological Society. 2017. Daily summaries of stream temperature at sites in Alaska, U.S. Geological Survey (USGS). Knowledge Network for Biocomplexity.](https://knb.ecoinformatics.org/view/urn:uuid:48903077-e89d-4e92-9577-8b8c32cc6c7a)
    + Contact: U.S. Geological Society